<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
  <style>
    :root {
      --primary-color: #004080;
      --accent-color: #28a745;
      --danger-color: #dc3545;
      --info-color: #4caf50;
      --warn-color: #ffc107;
      --font-color: #212529;
      --bg-color: #f4f6f9;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-color);
      margin: 0;
      color: var(--font-color);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: var(--primary-color);
      color: white;
      text-align: center;
      padding: 16px;
    }
    main {
      flex: 1;
      max-width: 880px;
      margin: 20px auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--primary-color);
      margin-bottom: 16px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 12px;
      font-weight: bold;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      color: var(--primary-color);
    }
    .tab.active {
      border-color: var(--accent-color);
      color: var(--accent-color);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    input[type="file"], select, input[type="text"], button {
      width: 100%;
      padding: 10px;
      margin: 6px 0 12px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: var(--primary-color);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:hover:not(:disabled) {
      background: #002855;
    }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    .status-message {
      font-weight: bold;
      margin: 8px 0;
    }
    .status-message.success { color: var(--accent-color); }
    .status-message.error { color: var(--danger-color); }
    .status-message.loading::before { content: "\23F3 "; }
    .download-link { margin: 6px 0; }
    .section {
      background: #fdfdfd;
      border-left: 4px solid var(--primary-color);
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
      line-height: 1.5;
    }
    .accent { border-left-color: var(--warn-color); }
    .info { border-left-color: var(--info-color); }
    .warning { border-left-color: var(--danger-color); }
    .footer {
      text-align: center;
      padding: 16px;
      font-size: 13px;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>–¶–µ–Ω—Ç—Ä –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ê–Ω–∞–ª–∏—Ç–∏–∫–∏</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –ú–ö–ë-10</p>
  </header>

  <main>
    <div class="tabs">
      <div class="tab active" data-tab="check">üìÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ Excel</div>
      <div class="tab" data-tab="mkb">üîç –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ú–ö–ë-10</div>
    </div>

    <section id="check" class="tab-content active">
      <h2>üìÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</h2>
      <input type="file" id="fileInput" accept=".xlsx" />
      <select id="reportType">
        <option value="A">–û—Ç—á–µ—Ç A ‚Äî –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</option>
        <option value="B">–û—Ç—á–µ—Ç B ‚Äî –í–Ω–µ—à–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
      </select>
      <button onclick="uploadFile()">üöÄ –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
      <div id="status" class="status-message"></div>
      <div id="downloadLink" class="download-link"></div>
      <div id="adminPanel" style="display:none; font-size:13px; color:#555;">
        üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ª–∏—Å—Ç <b>¬´–î–æ—Å—Ç—É–ø¬ª</b>
      </div>
    </section>

    <section id="mkb" class="tab-content">
      <h2>üîç –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –ú–ö–ë-10</h2>
      <input type="text" id="mkbInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: J45" />
      <button onclick="–ø–æ–ª—É—á–∏—Ç—å()">üîé –ù–∞–π—Ç–∏</button>
      <div id="result" class="result-box" style="margin-top:10px; display:none;"></div>
    </section>
  </main>

  <footer class="footer">&copy; 2025 –¶–µ–Ω—Ç—Ä –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ê–Ω–∞–ª–∏—Ç–∏–∫–∏</footer>

  <script>
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
      });
    });

    function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const reportType = document.getElementById('reportType').value;
      const status = document.getElementById('status');
      const downloadLink = document.getElementById('downloadLink');
      if (!fileInput.files.length) {
        alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .xlsx");
        return;
      }
      status.className = 'status-message loading';
      status.textContent = "–§–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...";
      downloadLink.innerHTML = "";
      const reader = new FileReader();
      reader.onload = function(e) {
        const base64 = e.target.result;
        google.script.run
          .withSuccessHandler(url => {
            status.className = 'status-message success';
            status.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ.";
            downloadLink.innerHTML = `<a href="${url}" target="_blank">üì• –°–∫–∞—á–∞—Ç—å</a>`;
          })
          .withFailureHandler(error => {
            status.className = 'status-message error';
            status.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
          })
          .processUploadedFile(base64, fileInput.files[0].name, reportType);
      };
      reader.readAsDataURL(fileInput.files[0]);
    }

    google.script.run.withSuccessHandler(email => {
      if (email === "tolegen.kazybek1993@gmail.com") {
        document.getElementById("adminPanel").style.display = "block";
      }
    }).getCurrentUserEmail();

    function –ø–æ–ª—É—á–∏—Ç—å() {
      const –∫–æ–¥ = document.getElementById('mkbInput').value.trim().toUpperCase();
      const resultBox = document.getElementById('result');
      resultBox.style.display = 'block';
      resultBox.innerHTML = "‚è≥ –ü–æ–∏—Å–∫...";

      if (!–∫–æ–¥) {
        resultBox.innerHTML = "<b>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–∏–∞–≥–Ω–æ–∑–∞.</b>";
        return;
      }

      google.script.run.withSuccessHandler(function(res) {
        let html = '';
        let –æ—Å—Ç—Ä–æ–µ–ì–û–ë–ú–ü = false;
        let –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ–û–°–ú–° = false;

        const —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ–ó–∞–ø–∏—Å–∏ = new Set();
        const –±–ª–æ–∫–∏ = [];

        if (!res || res.length === 0) {
          html += `<div class="section warning"><b>‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ '–ü—Ä–∞–≤–∏–ª–∞'</b></div>`;
        } else {
          res.forEach(row => {
            const –ø–æ–≤–æ–¥ = (row[0] || '').trim();
            const –æ–ø–ª–∞—Ç–∞ = (row[1] || '').trim();
            const –∫–ª—é—á = –ø–æ–≤–æ–¥ + '|' + –æ–ø–ª–∞—Ç–∞;
            if (!—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ–ó–∞–ø–∏—Å–∏.has(–∫–ª—é—á)) {
              —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ–ó–∞–ø–∏—Å–∏.add(–∫–ª—é—á);
              –±–ª–æ–∫–∏.push(`–ü–æ–≤–æ–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è: <b>${–ø–æ–≤–æ–¥}</b><br>–¢–∏–ø –æ–ø–ª–∞—Ç—ã: <b>${–æ–ø–ª–∞—Ç–∞}</b>`);
            }
            if (–ø–æ–≤–æ–¥.toLowerCase().includes("–æ–±–æ—Å—Ç—Ä–µ–Ω–∏–µ") && –æ–ø–ª–∞—Ç–∞.toLowerCase() === "–≥–æ–±–º–ø") –æ—Å—Ç—Ä–æ–µ–ì–û–ë–ú–ü = true;
            if (–ø–æ–≤–æ–¥.toLowerCase().includes("—Å–æ—Ü–∏–∞–ª—å–Ω–æ") && –æ–ø–ª–∞—Ç–∞.toLowerCase() === "–æ—Å–º—Å") –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ–û–°–ú–° = true;
          });
          html += `<div class="section accent"><b>üìå –ò–∑ —Ç–∞–±–ª–∏—Ü—ã:</b><br>${–±–ª–æ–∫–∏.join('<br><br>')}</div>`;
        }

        if (–æ—Å—Ç—Ä–æ–µ–ì–û–ë–ú–ü) {
          html += `
            <div class="section warning">
              ‚ö†Ô∏è <b>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</b><br>
              –ü—Ä–∏ –ø–æ–≤–æ–¥–µ –æ–±—Ä–∞—â–µ–Ω–∏—è <b>"–û—Å—Ç—Ä–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)/–û–±–æ—Å—Ç—Ä–µ–Ω–∏–µ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"</b> –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–µ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è <b>–ì–û–ë–ú–ü</b> ‚Äî –¥–∏–∞–≥–Ω–æ–∑ –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å <b>–¥–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</b> —Å–æ–≥–ª–∞—Å–Ω–æ <b>–ø—Ä–∏–∫–∞–∑—É ‚Ññ149 –ú–ó –†–ö</b>.<br><br>
              üí° <b>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</b><br>
              üìã –í–∑—è—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞ –Ω–∞ <b>–¥–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω—ã–π —É—á—ë—Ç</b><br>
              ${–ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ–û–°–ú–° ? "‚úÖ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤–æ–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è <b>\"–ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–∑–Ω–∞—á–∏–º–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ\"</b> —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è <b>–û–°–ú–°</b>, –µ—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç –Ω–∞ –¥–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–º —É—á—ë—Ç–µ." : "‚úÖ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã –¥–∏–∞–≥–Ω–æ–∑–∞, –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å <b>–û–°–ú–°</b> –ø—Ä–∏ –¥–∞–Ω–Ω–æ–º –ø–æ–≤–æ–¥–µ –æ–±—Ä–∞—â–µ–Ω–∏—è."}
            </div>`;
        }

        if (–∫–æ–¥.startsWith("Z34") || –∫–æ–¥ === "Z36") {
          html += `
            <div class="section warning">
              ‚ö†Ô∏è <b>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</b><br>
              –î–∏–∞–≥–Ω–æ–∑—ã <b>Z34</b> –∏ <b>Z36</b> –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ <b>—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É —Ç–µ—á–µ–Ω–∏—é –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏</b>.<br><br>
              üí° <b>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</b><br>
              –ù–∞–∑–Ω–∞—á–∞—Ç—å —É—Å–ª—É–≥–∏ –ø–æ –Ω–∏–º —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö <b>–ø–ª–∞–Ω–æ–≤—ã—Ö —è–≤–æ–∫</b>. –ü—Ä–∏ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥—ã: <b>Z35</b>, <b>O10‚ÄìO16</b>, <b>O20‚ÄìO29</b>.
            </div>`;
        }

        resultBox.innerHTML = html;
      }).–ø–æ–ª—É—á–∏—Ç—å–ü–æ–¥—Å–∫–∞–∑–∫—É(–∫–æ–¥);
    }
  </script>
</body>
</html>
